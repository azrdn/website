---
import Menu from "../components/menu.svg"

const links = [
	{ text: "/about", href: "/about", desc: "who am i?" },
	{ text: "/blog", href: "/blog", desc: "i write too" },
	{ text: "/projects", href: "/projects", desc: "things i made" },
]

const { label = Astro.site?.hostname } = Astro.props
const is_homepage = Astro.url.pathname === "/"
---

<header class="topheader">
	<span id="label">{is_homepage ? "~/" : <a href="/">~/</a>} {label}</span>
	<button popovertarget="navbar-s" title="Menu">
		<Menu />
	</button>

	<nav popover id="navbar-s">
		<div class="desc">
			{links.map((link) => <span>{link.desc}</span>)}
		</div>
		<div class="links">
			{links.map((link) => <a href={link.href}>{link.text}</a>)}
		</div>
	</nav>
	<nav id="navbar-l">
		{links.map((link) => <a href={link.href}>{link.text}</a>)}
	</nav>
</header>

<script>
	const header = document.querySelector<HTMLElement>(".topheader")
	const mobile_menu = document.querySelector<HTMLElement>("#navbar-s")
	let last_scroll_top = 0

	window.addEventListener("scroll", () => {
		const scroll_top = window.scrollY || document.documentElement.scrollTop
		const dir = scroll_top > last_scroll_top ? "down" : "up"
		if (Math.abs(scroll_top - last_scroll_top) > 3) {
			header?.setAttribute("scroll-direction", dir)
		}
		last_scroll_top = scroll_top <= 0 ? 0 : scroll_top
		mobile_menu?.hidePopover()
	}, { passive: true })
</script>

<style>
	header {
		display: flex;
		justify-content: space-between;
		border-bottom: 1px solid var(--bg-secondary);
		padding: 1rlh 2ch;
		background-color: var(--bg);
		position: fixed;
		width: 100%;
		max-width: var(--max-width);
		z-index: 2;
		top: 0;
		transition: transform 0.2s ease;

		#label {
			color: var(--fg);
			a {
				text-decoration-color: var(--bg-secondary);
				text-decoration-style: dotted;
			}
		}

		&[scroll-direction="down"] {
			transform: translateY(-100%);
			pointer-events: none;
		}
	}

	button {
		all: unset;
		cursor: pointer;

		&:hover {
			color: var(--fg);
		}
	}

	.links,
	.desc {
		display: flex;
		flex-direction: column;
		gap: 1rlh;
	}

	.links {
		text-align: right;
	}

	#navbar-s[popover] {
		top: calc(2rlh + 1lh);
		color: var(--fg-secondary);
		background-color: var(--bg);
		justify-content: space-between;
		border: none;
		width: 100%;
		max-width: 80ch;
		margin: 0 auto;
		padding: 0 2ch 1rlh;
	}

	#navbar-s:popover-open {
		display: flex;
		border-bottom: 1px solid var(--bg-secondary);
	}

	#navbar-l {
		display: none;
	}

	@media (width >= 768px) {
		button[popovertarget="navbar-s"],
		#navbar-s[popover] {
			display: none;
		}

		#navbar-l {
			display: flex;
			gap: 3ch;
		}
	}
</style>
